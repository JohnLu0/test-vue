 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" > 
<head runat="server"> 
<title></title> 
    <link href="../jsui/themes/default/easyui.css" rel="stylesheet" type="text/css" />
    <link href="../jsui/themes/icon.css" rel="stylesheet" type="text/css" />
    <script src="../jsui/jquery-1.4.1.min.js" type="text/javascript"></script>
    <script src="../jsui/jquery.easyui.min.js" type="text/javascript"></script>
    <script src="../jsui/locale/easyui-lang-zh_CN.js" type="text/javascript"></script>
    <script src="jquery.DynamicTable.js" type="text/javascript"></script> 
    <link href="permisSum.css" rel="stylesheet" type="text/css" />
<script type="text/javascript">
    var parParam = new Object();
    var ccc = new Object();
    var changqu = new Object();
    var permis = new Object();
    var data1 = new Object();
    var data2 = new Object();
    var biaozhi = 3;

    var rowtmplate = "<tr class='xl326682' height=42 style='mso-height-source:userset;height:31.5pt'><td height=42 class='xl416682' style='height:31.5pt;border-top:none'><a></a></td><td rowspan=#@changqu class='xl446682' width=38 style='border-bottom:.5pt solid black;border-top:none;width:29pt'>#changqu</td><td rowspan=#@xingzhi class='xl426682' width=42 style='border-bottom:.5pt solid black;border-top:none;width:32pt'>#xingzhi</td>";
    rowtmplate += "<td class='xl416682' style='border-top:none;border-left:none'>#leibie</td><td class='xl416682' style='border-top:none;border-left:none'>#bu</td><td class='xl446682' style='border-top:none;border-left:none'>#sbu</td><td class='xl456682' width=133 style='border-top:none;border-left:none;width:100pt'>#zongfuze</td><td class='xl456682' width=136 style='border-top:none;border-left:none;width:102pt'>#zongganshi</td>";
    rowtmplate += "<td class='xl466682' style='border-top:none;border-left:none'>19</td><td class='xl466682' style='border-top:none;border-left:none'>3</td><td class='xl466682' style='border-top:none;border-left:none'>22</td><td class='xl466682' style='border-top:none;border-left:none'>　</td><td class='xl476682' style='border-top:none;border-left:none'>22 </td>";
    rowtmplate += "<td class='xl486682' style='border-top:none none;mso-ignore:style;background:lime;mso-pattern:auto none'>0.30%</td><td class='xl496682' style='border-top:none;border-left:none'>0.15%</td><td class='xl1136682' style='border-top:none;border-left:none'>7205</td><td class='xl466682' style='border-top:none;border-left:none'>5</td><td class='xl466682' style='border-top:none;border-left:none'>2</td><td class='xl466682' style='border-top:none;border-left:none'>7</td><td class='xl466682' style='border-top:none;border-left:none'>　</td><td class='xl476682' style='border-top:none;border-left:none'>7 </td><td class='xl486682' style='border-top:none none;mso-ignore:style;background:lime;mso-pattern:auto none'>0.10%</td>";
    rowtmplate += "<td class='xl496682' style='border-top:none;border-left:none'>0.13%</td><td class='xl1136682' style='border-top:none;border-left:none'>7238</td><td class='xl466682' style='border-top:none;border-left:none'>11</td><td class='xl466682' style='border-top:none;border-left:none'>2</td><td class='xl466682' style='border-top:none;border-left:none'>13</td><td class='xl466682' style='border-top:none;border-left:none'>　</td><td class='xl476682' style='border-top:none;border-left:none'>13 </td><td class='xl486682' style='border-top:none none;mso-ignore:style;background:lime;mso-pattern:auto none'>0.18%</td><td class='xl496682' style='border-top:none;border-left:none'>0.11%</td><td class='xl1136682' style='border-top:none;border-left:none'>7217</td>";
    rowtmplate += "<td class='xl506682' style='border-top:none;border-left:none'>#REF!</td> <td class='xl486682' style='border-top:none;border-left:none'>#REF!</td><td class='xl516682' style='border-top:none;border-left:none'>#REF!</td> <td class='xl526682' style='border-top:none;border-left:none')>#REF!</td></tr>";


    var rowtmplate1 = "<tr class='xl326682' height=42 style='mso-height-source:userset;height:31.5pt'><td height=42 class='xl416682' style='height:31.5pt;border-top:none'><a></a></td>";
    rowtmplate1 += "<td class='xl416682' style='border-top:none;border-left:none'>#leibie</td><td class='xl416682' style='border-top:none;border-left:none'>#bu</td><td class='xl446682' style='border-top:none;border-left:none'>#sbu</td><td class='xl456682' width=133 style='border-top:none;border-left:none;width:100pt'>#zongfuze</td><td class='xl456682' width=136 style='border-top:none;border-left:none;width:102pt'>#zongganshi</td>";
    rowtmplate1 += "<td class='xl466682' style='border-top:none;border-left:none'>19</td><td class='xl466682' style='border-top:none;border-left:none'>3</td><td class='xl466682' style='border-top:none;border-left:none'>22</td><td class='xl466682' style='border-top:none;border-left:none'>　</td><td class='xl476682' style='border-top:none;border-left:none'>22 </td>";
    rowtmplate1 += "<td class='xl486682' style='border-top:none none;mso-ignore:style;background:lime;mso-pattern:auto none'>0.30%</td><td class='xl496682' style='border-top:none;border-left:none'>0.15%</td><td class='xl1136682' style='border-top:none;border-left:none'>7205</td><td class='xl466682' style='border-top:none;border-left:none'>5</td><td class='xl466682' style='border-top:none;border-left:none'>2</td><td class='xl466682' style='border-top:none;border-left:none'>7</td><td class='xl466682' style='border-top:none;border-left:none'>　</td><td class='xl476682' style='border-top:none;border-left:none'>7 </td><td class='xl486682' style='border-top:none none;mso-ignore:style;background:lime;mso-pattern:auto none'>0.10%</td>";
    rowtmplate1 += "<td class='xl496682' style='border-top:none;border-left:none'>0.13%</td><td class='xl1136682' style='border-top:none;border-left:none'>7238</td><td class='xl466682' style='border-top:none;border-left:none'>11</td><td class='xl466682' style='border-top:none;border-left:none'>2</td><td class='xl466682' style='border-top:none;border-left:none'>13</td><td class='xl466682' style='border-top:none;border-left:none'>　</td><td class='xl476682' style='border-top:none;border-left:none'>13 </td><td class='xl486682' style='border-top:none none;mso-ignore:style;background:lime;mso-pattern:auto none'>0.18%</td><td class='xl496682' style='border-top:none;border-left:none'>0.11%</td><td class='xl1136682' style='border-top:none;border-left:none'>7217</td>";
    rowtmplate1 += "<td class='xl506682' style='border-top:none;border-left:none'>#REF!</td> <td class='xl486682' style='border-top:none;border-left:none'>#REF!</td><td class='xl516682' style='border-top:none;border-left:none'>#REF!</td> <td class='xl526682' style='border-top:none;border-left:none')>#REF!</td></tr>";

    var rowtmplate2 = "<tr class='xl326682' height=42 style='mso-height-source:userset;height:31.5pt'><td height=42 class='xl416682' style='height:31.5pt;border-top:none'><a></a></td><td rowspan=#@xingzhi class='xl426682' width=42 style='border-bottom:.5pt solid black;border-top:none;width:32pt'>#xingzhi</td>";
    rowtmplate2 += "<td class='xl416682' style='border-top:none;border-left:none'>#leibie</td><td class='xl416682' style='border-top:none;border-left:none'>#bu</td><td class='xl446682' style='border-top:none;border-left:none'>#sbu</td><td class='xl456682' width=133 style='border-top:none;border-left:none;width:100pt'>#zongfuze</td><td class='xl456682' width=136 style='border-top:none;border-left:none;width:102pt'>#zongganshi</td>";
    rowtmplate2 += "<td class='xl466682' style='border-top:none;border-left:none'>19</td><td class='xl466682' style='border-top:none;border-left:none'>3</td><td class='xl466682' style='border-top:none;border-left:none'>22</td><td class='xl466682' style='border-top:none;border-left:none'>　</td><td class='xl476682' style='border-top:none;border-left:none'>22 </td>";
    rowtmplate2 += "<td class='xl486682' style='border-top:none none;mso-ignore:style;background:lime;mso-pattern:auto none'>0.30%</td><td class='xl496682' style='border-top:none;border-left:none'>0.15%</td><td class='xl1136682' style='border-top:none;border-left:none'>7205</td><td class='xl466682' style='border-top:none;border-left:none'>5</td><td class='xl466682' style='border-top:none;border-left:none'>2</td><td class='xl466682' style='border-top:none;border-left:none'>7</td><td class='xl466682' style='border-top:none;border-left:none'>　</td><td class='xl476682' style='border-top:none;border-left:none'>7 </td><td class='xl486682' style='border-top:none none;mso-ignore:style;background:lime;mso-pattern:auto none'>0.10%</td>";
    rowtmplate2 += "<td class='xl496682' style='border-top:none;border-left:none'>0.13%</td><td class='xl1136682' style='border-top:none;border-left:none'>7238</td><td class='xl466682' style='border-top:none;border-left:none'>11</td><td class='xl466682' style='border-top:none;border-left:none'>2</td><td class='xl466682' style='border-top:none;border-left:none'>13</td><td class='xl466682' style='border-top:none;border-left:none'>　</td><td class='xl476682' style='border-top:none;border-left:none'>13 </td><td class='xl486682' style='border-top:none none;mso-ignore:style;background:lime;mso-pattern:auto none'>0.18%</td><td class='xl496682' style='border-top:none;border-left:none'>0.11%</td><td class='xl1136682' style='border-top:none;border-left:none'>7217</td>";
    rowtmplate2 += "<td class='xl506682' style='border-top:none;border-left:none'>#REF!</td> <td class='xl486682' style='border-top:none;border-left:none'>#REF!</td><td class='xl516682' style='border-top:none;border-left:none'>#REF!</td> <td class='xl526682' style='border-top:none;border-left:none')>#REF!</td></tr>";

    var rowtmplate3="<tr class='xl326682' height=19 style='height:14.25pt'><td height=19 class='xl556682' colspan=3 style='height:14.25pt'>#leibie</td><td class='xl566682' style='border-top:none'>　</td><td class='xl566682' style='border-top:none'>　</td><td class='xl566682' style='border-top:none'>　</td><td class='xl566682' style='border-top:none'>　</td><td class='xl576682' style='border-top:none'>　</td>";
    rowtmplate3 += "<td class='xl586682' style='border-top:none;border-left:none'>20 </td><td class='xl586682' style='border-top:none;border-left:none'>3 </td><td class='xl586682' style='border-top:none;border-left:none'>23 </td>";
    rowtmplate3 += "<td class='xl586682' style='border-top:none;border-left:none'>0 </td><td class='xl586682' style='border-top:none;border-left:none'>23 </td><td class='xl596682' style='border-top:none;border-left:none'>0.30%</td><td class='xl496682' style='border-top:none;border-left:none'>0.15%</td><td class='xl586682' style='border-top:none;border-left:none'>7560 </td> <td class='xl586682' style='border-top:none;border-left:none'>5 </td><td class='xl586682' style='border-top:none;border-left:none'>2 </td>";
    rowtmplate3 += "<td class='xl586682' style='border-top:none;border-left:none'>7 </td><td class='xl586682' style='border-top:none;border-left:none'>0 </td><td class='xl586682' style='border-top:none;border-left:none'>7 </td><td class='xl596682' style='border-top:none;border-left:none'>0.09%</td><td class='xl496682' style='border-top:none;border-left:none'>0.13%</td><td class='xl586682' style='border-top:none;border-left:none'>7593 </td><td class='xl586682' style='border-top:none;border-left:none'>12 </td><td class='xl586682' style='border-top:none;border-left:none'>3 </td><td class='xl586682' style='border-top:none;border-left:none'>15 </td><td class='xl586682' style='border-top:none;border-left:none'>0 </td><td class='xl586682' style='border-top:none;border-left:none'>15 </td><td class='xl596682' style='border-top:none;border-left:none'>0.20%</td>";
    rowtmplate3 += "<td class='xl496682' style='border-top:none;border-left:none'></td><td class='xl586682' style='border-top:none;border-left:none'>7570 </td><td class='xl506682' style='border-top:none;border-left:none'>#REF!</td><td class='xl486682' style='border-top:none;border-left:none'>#REF!</td><td class='xl516682' style='border-top:none;border-left:none'>#REF!</td><td class='xl526682' style='border-top:none;border-left:none'>#REF!</td></tr>";

    var rowtmplate4="<tr class='xl326682' height=23 style='mso-height-source:userset;height:17.25pt'><td height=23 class='xl616682' colspan=3 style='height:17.25pt'>#bu</td><td class='xl626682' style='border-top:none'>　</td><td class='xl626682' style='border-top:none'>　</td><td class='xl626682' style='border-top:none'>　</td><td class='xl626682' style='border-top:none'>　</td><td class='xl636682' style='border-top:none'>　</td><td class='xl646682' style='border-top:none;border-left:none'>3 </td>";
    rowtmplate4 += "<td class='xl646682' style='border-top:none;border-left:none'></td><td class='xl646682' style='border-top:none;border-left:none'>4 </td><td class='xl646682' style='border-top:none;border-left:none'>0 </td> <td class='xl646682' style='border-top:none;border-left:none'>4 </td> <td class='xl656682' style='border-top:none;border-left:none'>0.31%</td>";
    rowtmplate4 += "<td class='xl496682' style='border-top:none;border-left:none'></td> <td class='xl646682' style='border-top:none;border-left:none'>1304 </td> <td class='xl646682' style='border-top:none;border-left:none'>2 </td><td class='xl646682' style='border-top:none;border-left:none'>2 </td><td class='xl646682' style='border-top:none;border-left:none'>4 </td>";
    rowtmplate4 += "<td class='xl646682' style='border-top:none;border-left:none'></td><td class='xl646682' style='border-top:none;border-left:none'>4 </td><td class='xl656682' style='border-top:none;border-left:none'>0.31%</td><td class='xl496682' style='border-top:none;border-left:none'>0.13%</td><td class='xl646682' style='border-top:none;border-left:none'>1300 </td><td class='xl646682' style='border-top:none;border-left:none'>0 </td><td class='xl646682' style='border-top:none;border-left:none'>0 </td><td class='xl646682' style='border-top:none;border-left:none'>0 </td><td class='xl646682' style='border-top:none;border-left:none'>0 </td>";
    rowtmplate4 += "<td class='xl646682' style='border-top:none;border-left:none'></td><td class='xl656682' style='border-top:none;border-left:none'>0.00%</td> <td class='xl496682' style='border-top:none;border-left:none'>0.11%</td><td class='xl646682' style='border-top:none;border-left:none'>1299 </td><td class='xl506682' style='border-top:none;border-left:none'>#REF!</td><td class='xl486682' style='border-top:none;border-left:none'>#REF!</td><td class='xl516682' style='border-top:none;border-left:none'>#REF!</td><td class='xl526682' style='border-top:none;border-left:none'>#REF!</td></tr>";

    var rowtmplate5 = "<tr><td align='center' class='style6'>#gonghao</td><td align='center' class='style7'>#xingming</td><td align='center' class='style4'>#ziwei</td><td align='center' class='style5'>#sbu</td><td align='center'>#yuanying</td></tr>"

    var rowtmplate6 = "<tr class='xl326682' height=23 style='mso-height-source:userset;height:17.25pt'><td height=23 class='x7346682' colspan=3 style='height:17.25pt'>#bu</td><td class='x9346682' style='border-top:none'>　</td><td class='x9346682' style='border-top:none'>　</td><td class='x9346682' style='border-top:none'>　</td><td class='x9346682' style='border-top:none'>　</td><td class='x8346682' style='border-top:none'>　</td><td class='x3346682' style='border-top:none;border-left:none'>3 </td>";
    rowtmplate6 += "<td class='x3346682' style='border-top:none;border-left:none'></td><td class='x3346682' style='border-top:none;border-left:none'>4 </td><td class='x3346682' style='border-top:none;border-left:none'>0 </td> <td class='x3346682' style='border-top:none;border-left:none'>4 </td> <td class='xl656682' style='border-top:none;border-left:none'>0.31%</td>";
    rowtmplate6 += "<td class='xl496682' style='border-top:none;border-left:none'></td> <td class='x3346682' style='border-top:none;border-left:none'>1304 </td> <td class='x3346682' style='border-top:none;border-left:none'>2 </td><td class='x3346682' style='border-top:none;border-left:none'>2 </td><td class='x3346682' style='border-top:none;border-left:none'>4 </td>";
    rowtmplate6 += "<td class='x3346682' style='border-top:none;border-left:none'></td><td class='x3346682' style='border-top:none;border-left:none'>4 </td><td class='xl656682' style='border-top:none;border-left:none'>0.31%</td><td class='xl496682' style='border-top:none;border-left:none'>0.13%</td><td class='x3346682' style='border-top:none;border-left:none'>1300 </td><td class='x3346682' style='border-top:none;border-left:none'>0 </td><td class='x3346682' style='border-top:none;border-left:none'>0 </td><td class='x3346682' style='border-top:none;border-left:none'>0 </td><td class='x3346682' style='border-top:none;border-left:none'>0 </td>";
    rowtmplate6 += "<td class='x3346682' style='border-top:none;border-left:none'></td><td class='xl656682' style='border-top:none;border-left:none'>0.00%</td> <td class='xl496682' style='border-top:none;border-left:none'>0.11%</td><td class='x3346682' style='border-top:none;border-left:none'>1299 </td><td class='xl506682' style='border-top:none;border-left:none'>#REF!</td><td class='xl486682' style='border-top:none;border-left:none'>#REF!</td><td class='xl516682' style='border-top:none;border-left:none'>#REF!</td><td class='xl526682' style='border-top:none;border-left:none'>#REF!</td></tr>";

    var rowtmplate7 = "<tr class='xl326682' height=23 style='mso-height-source:userset;height:17.25pt'><td height=23 class='x7446682' colspan=3 style='height:17.25pt'>#bu</td><td class='x9446682' style='border-top:none'>　</td><td class='x9446682' style='border-top:none'>　</td><td class='x9446682' style='border-top:none'>　</td><td class='x9446682' style='border-top:none'>　</td><td class='x8446682' style='border-top:none'>　</td><td class='x4446682' style='border-top:none;border-left:none'>3 </td>";
    rowtmplate7 += "<td class='x4446682' style='border-top:none;border-left:none'></td><td class='x4446682' style='border-top:none;border-left:none'>4 </td><td class='x4446682' style='border-top:none;border-left:none'>0 </td> <td class='x4446682' style='border-top:none;border-left:none'>4 </td> <td class='xl656682' style='border-top:none;border-left:none'>0.31%</td>";
    rowtmplate7 += "<td class='xl496682' style='border-top:none;border-left:none'></td> <td class='x4446682' style='border-top:none;border-left:none'>1304 </td> <td class='x4446682' style='border-top:none;border-left:none'>2 </td><td class='x4446682' style='border-top:none;border-left:none'>2 </td><td class='x4446682' style='border-top:none;border-left:none'>4 </td>";
    rowtmplate7 += "<td class='x4446682' style='border-top:none;border-left:none'></td><td class='x4446682' style='border-top:none;border-left:none'>4 </td><td class='xl656682' style='border-top:none;border-left:none'>0.31%</td><td class='xl496682' style='border-top:none;border-left:none'>0.13%</td><td class='x4446682' style='border-top:none;border-left:none'>1300 </td><td class='x4446682' style='border-top:none;border-left:none'>0 </td><td class='x4446682' style='border-top:none;border-left:none'>0 </td><td class='x4446682' style='border-top:none;border-left:none'>0 </td><td class='x4446682' style='border-top:none;border-left:none'>0 </td>";
    rowtmplate7 += "<td class='x4446682' style='border-top:none;border-left:none'></td><td class='xl656682' style='border-top:none;border-left:none'>0.00%</td> <td class='xl496682' style='border-top:none;border-left:none'>0.11%</td><td class='x4446682' style='border-top:none;border-left:none'>1299 </td><td class='xl506682' style='border-top:none;border-left:none'>#REF!</td><td class='xl486682' style='border-top:none;border-left:none'>#REF!</td><td class='xl516682' style='border-top:none;border-left:none'>#REF!</td><td class='xl526682' style='border-top:none;border-left:none'>#REF!</td></tr>";
    var G1 = [{ ID: '淮安', TEXT: '淮安' }, { ID: '寶科', TEXT: '寶科' }, { ID: '贛州', TEXT: '贛州' }, { ID: '昆山', TEXT: '昆山' },
            { ID: '鄭州', TEXT: '鄭州' }, { ID: '豐城', TEXT: '豐城' }, { ID: '龍華', TEXT: '龍華' }, { ID: '廊坊', TEXT: '廊坊' },
             { ID: '重慶', TEXT: '重慶' }, { ID: 'ALL', TEXT: 'all'}];
             var GG = ['cable', 'connector', 'other', 'ACET', 'PDCT', 'CMIT', 'IDBC', 'CW', '周邊', 'FIT'];
    var DF = 0;
    var DM = false;
    $(function () {

        $('#load').window({
            title: '新增修改離職人員明細',
            width: 430,
            modal: true,
            shadow: true,
            closed: true,
            height: 450,
            resizable: false
        });
        $('#load1').window({
            title: '新增修改SBU信息',
            width: 430,
            modal: true,
            shadow: true,
            closed: true,
            height: 450,
            resizable: false
        });

        $('#load8').window({
            title: '離職人員明細',
            width: 600,
            modal: true,
            shadow: true,
            closed: true,
            height: 400,
            resizable: false
        });

        $('#load99').window({
            title: '加载提示',
            width: 300,
            modal: true,
            shadow: true,
            closed: true,
            height: 150,
            resizable: false
        });

        $('#btnCancel').click(function () {
            $('#load').window('close');
        });
        $('#btnCancel1').click(function () {
            $('#load1').window('close');
        });

        var d = new Date();


        var LINT_YYYY = d.getFullYear();
        var LINT_MM = d.getMonth();
        var LINT_DD = d.getDate();

        var uom = new Date(LINT_YYYY, LINT_MM, LINT_DD);
        uom.setDate(uom.getDate() - 3);
        var vMon = uom.getMonth();
        vMon++;
        if (vMon < 10) {
            vMon = "0" + vMon;
        }
        var vDate = uom.getDate();
        if (vDate < 10) {
            vDate = "0" + vDate;
        }
        var vYear = uom.getFullYear();
        var dat3 = vYear + '-' + vMon + '-' + vDate;

        uom = new Date(LINT_YYYY, LINT_MM, LINT_DD);
        uom.setDate(uom.getDate() - 2);
        vMon = uom.getMonth();
        vMon++;
        if (vMon < 10) {
            vMon = "0" + vMon;
        }
        var vDate = uom.getDate();
        if (vDate < 10) {
            vDate = "0" + vDate;
        }
        vYear = uom.getFullYear();
        dat2 = vYear + '-' + vMon + '-' + vDate;

        uom = new Date(LINT_YYYY, LINT_MM, LINT_DD);
        uom.setDate(uom.getDate() - 1);
        vMon = uom.getMonth();
        vMon++;
        if (vMon < 10) {
            vMon = "0" + vMon;
        }
        var vDate = uom.getDate();
        if (vDate < 10) {
            vDate = "0" + vDate;
        }
        vYear = uom.getFullYear();
        dat1 = vYear + '-' + vMon + '-' + vDate;
        dddd = vYear + '-' + vMon + '-' + '01';
        changqu = $("#area", parent.document).text();
        permis = $("#permis", parent.document).text();
        if (permis == 'admin') {
            $("#diqu").combobox({
                editable: false,
                data: G1,
                valueField: 'ID',
                textField: 'TEXT',
                panelHeight: 'auto',
                onSelect: function (rec) {
                    parParam.changqu = rec.TEXT;
                    parParam.mode = "load";
                    $("#mytbl tr").eq(2).nextAll().remove();
                    load();
                }
            });
            //changqu = $('#diqu').combobox('getText');
            changqu = 'all';
        }
        parParam = { dddd: dddd, mode: "load", vYear: vYear, vMon: vMon, dat3: dat3, dat2: dat2, dat1: dat1, vDate: vDate, changqu: changqu };
        load();

        $('#dd').datebox({
            onSelect: function (date) {
                if (date > uom) {
                    alert("日期不能大於等於當前日期！");
                    $('#dd').datebox('setValue', '重新選擇');
                }
            }
        });
        $('#lichang').datebox({
            onSelect: function (date) {
                if (date > uom) {
                    alert("日期不能大於等於當前日期！");
                    $('#dd').datebox('setValue', '重新選擇');
                }
            }
        });
    });
    function part_search() {
        var tm = $("input[name='dd']").val();
        if (tm != "" && tm != "重新選擇") {
            var LINT_YYYY = tm.substr(0, 4);
            var LINT_MM = tm.substr(5, 2) - 1;
            if (LINT_MM == 0) {
                LINT_MM = 12;
                LINT_YYYY = LINT_YYYY - 1;
            }
            var LINT_DD = tm.substr(8, 2);

            var uom = new Date(LINT_YYYY, LINT_MM, LINT_DD);
            uom.setDate(uom.getDate() - 2);
            var vMon = uom.getMonth();
            vMon++;
            if (vMon < 10) {
                vMon = "0" + vMon;
            }
            var vDate = uom.getDate();
            if (vDate < 10) {
                vDate = "0" + vDate;
            }
            var vYear = uom.getFullYear();
            var dat3 = vYear + '-' + vMon + '-' + vDate;

            uom = new Date(LINT_YYYY, LINT_MM, LINT_DD);
            uom.setDate(uom.getDate() - 1);
            vMon = uom.getMonth();
            vMon++;
            if (vMon < 10) {
                vMon = "0" + vMon;
            }
            var vDate = uom.getDate();
            if (vDate < 10) {
                vDate = "0" + vDate;
            }
            vYear = uom.getFullYear();
            dat2 = vYear + '-' + vMon + '-' + vDate;

            uom = new Date(LINT_YYYY, LINT_MM, LINT_DD);
            uom.setDate(uom.getDate());
            vMon = uom.getMonth();
            vMon++;
            if (vMon < 10) {
                vMon = "0" + vMon;
            }
            var vDate = uom.getDate();
            if (vDate < 10) {
                vDate = "0" + vDate;
            }
            vYear = uom.getFullYear();
            dat1 = vYear + '-' + vMon + '-' + vDate;

            parParam.dat1 = dat1;
            parParam.dat2 = dat2;
            parParam.dat3 = dat3;
            parParam.vYear = vYear;
            parParam.vMon = vMon;
            parParam.dddd = vYear + '-' + vMon + '-' + '01';
        }
        tm = parParam.vYear + "年" + parParam.vMon + "月FIT愛心平安工程每日離職率統計表";
        $("table tr:eq(0) td:eq(0)").text(tm);
        if (parParam.changqu == "all") {
            $("#mytbl tr").eq(2).nextAll().remove();
            load();
        }
        else {
            loaddata();
        }
    }
    var option = new Object();
    function load() {
        if (parParam.changqu == 'all') {
            DM = true;
        }
        if (DM) {
            parParam.changqu = G1[DF].TEXT;
            parParam.mode = 'all';
            $.post("getData.ashx",
            parParam,
            function (data, status) {
                if (data == "NG") {
                    alert("SBU資料為空，先維護廠區資料");
                }
                else {
                    data = eval("(" + data + ")");
                    option = data[0];
                    zhenghe();

                    $("table tr:eq(1) td:eq(10)").text(parParam.dat1);
                    $("table tr:eq(1) td:eq(9)").text(parParam.dat2);
                    $("table tr:eq(1) td:eq(8)").text(parParam.dat3);

                    data1 = data[1];
                    data2 = data[2];
                    var X1 = data1[0].m1;
                    var X2 = data1[1].m2;
                    var X3 = data1[2].m3;
                    bianli(X1, 1);
                    bianli(X2, 2);
                    bianli(X3, 3);
                    biaozhi = biaozhi + data1[0].m1.length;


                    DF++;
                    if (DF < 9) {
                        load();
                    }
                    else {
                        $.each(GG, function (n, value) {
                            if (n < 3) {
                                temp = rowtmplate6;
                            }
                            else {
                                temp = rowtmplate7;
                            }
                            temp = temp.replace("#bu", value + " 匯總");
                            $('#mytbl').find('tr:last-child').after(temp);
                        });
                        bianli(data2, 4);
                        DM = false;
                        parParam.changqu = G1[DF].TEXT;
                        DF = 0;
                        biaozhi = 3;
                        var titl = parParam.vYear + "年" + parParam.vMon + "月FIT愛心平安工程每日離職率統計表";
                        $("table tr:eq(0) td:eq(0)").text(titl);
                    }
                }
            });
        }
        else {
            $.post("getData.ashx",
            parParam,
            function (data, status) {
                if (data == "NG") {
                    alert("SBU資料為空，先維護廠區資料");
                }
                else {
                    data = eval("(" + data + ")");
                    option = data;
                    zhenghe();
                    loaddata();
                }
            });
            var titl = parParam.vYear + "年" + parParam.vMon + "月FIT愛心平安工程每日離職率統計表";
            $("table tr:eq(0) td:eq(0)").text(titl);
        }
    }
    function loaddata() {
        $('#load99').window('open');
        $("table tr:eq(1) td:eq(10)").text(parParam.dat1);
        $("table tr:eq(1) td:eq(9)").text(parParam.dat2);
        $("table tr:eq(1) td:eq(8)").text(parParam.dat3);
        if (option.length > 0) {
            parParam.mode = "shuju";
            $.post("getData.ashx",
            parParam,
            function (data, status) {
                if (data == "NG") {
                    $('#load99').window('close');
                    alert("SBU資料為空，先維護廠區資料");
                }
                else {
                    data = eval("(" + data + ")");
                    var X1 = data[0].m1;
                    var X2 = data[1].m2;
                    var X3 = data[2].m3;
                    bianli(X1, 1);
                    bianli(X2, 2);
                    bianli(X3, 3);
                }
            });
        }
    }
    function bianli(option, count) {
        var h = biaozhi;
        if (count == 1) {
            var g = h;
            var m = 24;
            var w = m;
            $.each(option, function (n, value) {
                if (n < ccc.first && n > 0) {
                    w = w - 2;
                }
                if (n == ccc.first) {
                    w = w - 1;
                }
                if (n > ccc.first && name < ccc.sum) {
                    w = w - 2;
                }
                /*if (option.length == 4 && n == ccc.first) {
                w = w - 1;
                }*/
                if (ccc.second == 0 && n == ccc.first) {
                    w = w - 1;
                }
                $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.yuan1);
                $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.yuan23);
                if (n < ccc.sum) {
                    $("table tr:eq(" + g + ") td:eq(" + w + ")").unbind("click");
                    $("table tr:eq(" + g + ") td:eq(" + w + ")").click(function (e) { tanchu(value.changqu, value.sbu, value.dat1, "%員%", e); });
                }
                $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.yuan);
                if (n < ccc.sum) {
                    $("table tr:eq(" + g + ") td:eq(" + w + ")").unbind("click");
                    $("table tr:eq(" + g + ") td:eq(" + w + ")").click(function (e) { tanchu(value.changqu, value.sbu, value.dat1, "%師%", e); });
                }
                $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.shi);
                $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.lizhi);
                $("table tr:eq(" + g + ") td:eq(" + w + ")").css({ "background-color": "lime" });
                var x = parseFloat(value.bili);
                if (isNaN(x)) {
                    value.bili = '0%';
                }
                if (x >= 4) {
                    $("table tr:eq(" + g + ") td:eq(" + w + ")").css({ "background-color": "yellow" });
                }
                if (x >= 5) {
                    $("table tr:eq(" + g + ") td:eq(" + w + ")").css({ "background-color": "red" });
                }
                $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.bili);
                $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.biaozhun);
                $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.sum);
                $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.yue);
                $("table tr:eq(" + g + ") td:eq(" + w + ")").css({ "background-color": "lime" });
                var z = parseFloat(value.yuebili);
                if (isNaN(z)) {
                    value.yuebili = '0%';
                }
                if (z >= 4) {
                    $("table tr:eq(" + g + ") td:eq(" + w + ")").css({ "background-color": "yellow" });
                }
                if (z >= 5) {
                    $("table tr:eq(" + g + ") td:eq(" + w + ")").css({ "background-color": "red" });
                }
                $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.yuebili);
                $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.biaozhun);
                $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.sum1);
                g++;
                w = m;
            });
        }
        if (count == 2) {
            var g = h;
            var m = 16;
            var w = m;
            $.each(option, function (n, value) {
                if (n < ccc.first && n > 0) {
                    w = w - 2;
                }
                if (n == ccc.first) {
                    w = w - 1;
                }
                if (n > ccc.first) {
                    w = w - 2;
                }
                if (ccc.second == 0 && n == ccc.first) {
                    w = w - 1;
                }
                $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.yuan1);
                $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.yuan23);
                if (n < ccc.sum) {
                    $("table tr:eq(" + g + ") td:eq(" + w + ")").unbind("click");
                    $("table tr:eq(" + g + ") td:eq(" + w + ")").click(function (e) { tanchu(value.changqu, value.sbu, value.dat1, "%員%", e); });
                }
                $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.yuan);
                if (n < ccc.sum) {
                    $("table tr:eq(" + g + ") td:eq(" + w + ")").unbind("click");
                    $("table tr:eq(" + g + ") td:eq(" + w + ")").click(function (e) { tanchu(value.changqu, value.sbu, value.dat1, "%師%", e); });
                }
                $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.shi);
                $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.lizhi);
                $("table tr:eq(" + g + ") td:eq(" + w + ")").css({ "background-color": "lime" });
                var z = parseFloat(value.bili);
                if (isNaN(z)) {
                    value.bili='0%'
                }
                if (z >= 4) {
                    $("table tr:eq(" + g + ") td:eq(" + w + ")").css({ "background-color": "yellow" });
                }
                if (z >= 5) {
                    $("table tr:eq(" + g + ") td:eq(" + w + ")").css({ "background-color": "red" });
                }
                $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.bili);
                $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.biaozhun);
                $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.sum);
                g++;
                w = m;
            });
        }
        if (count == 3) {
            var g = h;
            var m = 8;
            var w = m;
            $.each(option, function (n, value) {
                if (n < ccc.first && n > 0) {
                    w = w - 2;
                }
                if (n == ccc.first) {
                    w = w - 1;
                }
                if (n > ccc.first) {
                    w = w - 2;
                }
                if (ccc.second == 0 && n == ccc.first) {
                    w = w - 1;
                }
                $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.yuan1);
                $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.yuan23);
                if (n < ccc.sum) {
                    $("table tr:eq(" + g + ") td:eq(" + w + ")").unbind("click");
                    $("table tr:eq(" + g + ") td:eq(" + w + ")").click(function (e) { tanchu(value.changqu, value.sbu, value.dat1, "%員%", e); });
                }
                $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.yuan);
                if (n < ccc.sum) {
                    $("table tr:eq(" + g + ") td:eq(" + w + ")").unbind("click");
                    $("table tr:eq(" + g + ") td:eq(" + w + ")").click(function (e) { tanchu(value.changqu, value.sbu, value.dat1, "%師%", e); });
                }
                $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.shi);
                $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.lizhi);
                $("table tr:eq(" + g + ") td:eq(" + w + ")").css({ "background-color": "lime" });
                var z = parseFloat(value.bili);
                if (isNaN(z)) {
                    value.bili = '0%';
                }
                if (z >= 4) {
                    $("table tr:eq(" + g + ") td:eq(" + w + ")").css({ "background-color": "yellow" });
                }
                if (z >= 5) {
                    $("table tr:eq(" + g + ") td:eq(" + w + ")").css({ "background-color": "red" });
                }
                $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.bili);
                $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.biaozhun);
                $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.sum);
                g++;
                w = m;
            });
        }
        if (count == 4) {
            var g = h;
            var m = 22;
            var w = m;
            $.each(option, function (n, value) {
                if (n < 10) {
                    $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.yuan1);
                    $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.yuan23);
                    if (n < ccc.sum) {
                        $("table tr:eq(" + g + ") td:eq(" + w + ")").unbind("click");
                        $("table tr:eq(" + g + ") td:eq(" + w + ")").click(function (e) { tanchu(value.changqu, value.sbu, value.dat1, "%員%", e); });
                    }
                    $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.yuan);
                    if (n < ccc.sum) {
                        $("table tr:eq(" + g + ") td:eq(" + w + ")").unbind("click");
                        $("table tr:eq(" + g + ") td:eq(" + w + ")").click(function (e) { tanchu(value.changqu, value.sbu, value.dat1, "%師%", e); });
                    }
                    $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.shi);
                    $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.lizhi);
                    $("table tr:eq(" + g + ") td:eq(" + w + ")").css({ "background-color": "lime" });
                    var x = parseFloat(value.bili);
                    if (isNaN(x)) {
                        value.bili = '0%';
                    }
                    if (x >= 4) {
                        $("table tr:eq(" + g + ") td:eq(" + w + ")").css({ "background-color": "yellow" });
                    }
                    if (x >= 5) {
                        $("table tr:eq(" + g + ") td:eq(" + w + ")").css({ "background-color": "red" });
                    }
                    $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.bili);
                    $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.biaozhun);
                    $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.sum);
                    $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.yue);
                    $("table tr:eq(" + g + ") td:eq(" + w + ")").css({ "background-color": "lime" });
                    var z = parseFloat(value.yuebili);
                    if (isNaN(z)) {
                        value.yuebili = '0%';
                    }
                    if (z >= 4) {
                        $("table tr:eq(" + g + ") td:eq(" + w + ")").css({ "background-color": "yellow" });
                    }
                    if (z >= 5) {
                        $("table tr:eq(" + g + ") td:eq(" + w + ")").css({ "background-color": "red" });
                    }
                    $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.yuebili);
                    $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.biaozhun);
                    $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.sum1);
                    g++;
                    w = m;
                }
                else {
                    if (n == 10) {
                        m = 14;
                        w = m;
                        g = h;
                    }
                    if (n == 20) {
                        m = 6;
                        w = m;
                        g = h;
                    }
                    $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.yuan1);
                    $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.yuan23);
                    if (n < ccc.sum) {
                        $("table tr:eq(" + g + ") td:eq(" + w + ")").unbind("click");
                        $("table tr:eq(" + g + ") td:eq(" + w + ")").click(function (e) { tanchu(value.changqu, value.sbu, value.dat1, "%員%", e); });
                    }
                    $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.yuan);
                    if (n < ccc.sum) {
                        $("table tr:eq(" + g + ") td:eq(" + w + ")").unbind("click");
                        $("table tr:eq(" + g + ") td:eq(" + w + ")").click(function (e) { tanchu(value.changqu, value.sbu, value.dat1, "%師%", e); });
                    }
                    $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.shi);
                    $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.lizhi);
                    $("table tr:eq(" + g + ") td:eq(" + w + ")").css({ "background-color": "lime" });
                    var z = parseFloat(value.bili);
                    if (isNaN(z)) {
                        value.bili = '0%';
                    }
                    if (z >= 4) {
                        $("table tr:eq(" + g + ") td:eq(" + w + ")").css({ "background-color": "yellow" });
                    }
                    if (z >= 5) {
                        $("table tr:eq(" + g + ") td:eq(" + w + ")").css({ "background-color": "red" });
                    }
                    $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.bili);
                    $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.biaozhun);
                    $("table tr:eq(" + g + ") td:eq(" + w++ + ")").text(value.sum);
                    g++;
                    w = m;
                }
            });
        }
        $('#load99').window('close');
    }
    function tanchu(changqu, sbu, lichang, ziwei,e) {
        var opop = { mode: "canshu", changqu: changqu, sbu: sbu, lichang: lichang, ziwei: ziwei };
        $.post("getData.ashx",
            opop,
            function (data, status) {
                if (data == "NG") {
                    alert("暫無數據");
                }
                else {
                    data = eval("(" + data + ")");
                    $.each(data, function (n, value) {
                        temp = rowtmplate5;
                        temp = temp.replace("#gonghao", value.gonghao);
                        temp = temp.replace("#xingming", value.xingming);
                        temp = temp.replace("#ziwei", value.ziwei);
                        temp = temp.replace("#sbu", value.sbu);
                        temp = temp.replace("#yuanying", value.yuanying);
                        $('#mingxi').find('tr:last-child').after(temp);
                    });
                    $('#load8').window('move', { left: getX(e), top: getY(e) }).window('open');
                }
            });
        }
    function getX(e) {
        e = e || window.event;

        return e.pageX || e.clientX + document.body.scroolLeft;
    }

    function getY(e) {
        e = e || window.event;
        return e.pageY || e.clientY + document.boyd.scrollTop;
    }
    function zhenghe() {
        var sum = option.length;
        var fenzhu = 0;
        var xiangci = 0;
        var biaozhi = 0;
        var first = 0;
        var second = 0;
        var canshu = new Object();
        var canshu1 = new Array();
        var bu = new Array();
        var temp = new Object();
        if (sum > 0) {
            $.each(option, function (n, value) {
                if (canshu.xingzhi != value.xingzhi) {
                    canshu.xingzhi = value.xingzhi;
                    fenzhu++;
                    biaozhi++;
                }
                if (biaozhi < 2) {
                    first++;
                }
                else {
                    second++;
                }
                if (!($.inArray(value.leibie, canshu1) >= 0)) {
                    canshu1.push(value.leibie);
                    xiangci++;
                }
            });
            $.each(option, function (n, value) {
                if (!($.inArray(value.bu, bu) >= 0)) {
                    bu.push(value.bu);
                }
                if (n < 1) {
                    temp = rowtmplate;
                    temp = temp.replace("#changqu", value.changqu);
                    temp = temp.replace("#xingzhi", value.xingzhi);
                    temp = temp.replace("#leibie", value.leibie);
                    temp = temp.replace("#bu", value.bu);
                    temp = temp.replace("#sbu", value.sbu);
                    temp = temp.replace("#zongfuze", value.zongfuze+value.zongji);
                    temp = temp.replace("#zongganshi", value.zongganshi + value.ganji);
                    temp = temp.replace("#@changqu", sum);
                    temp = temp.replace("#@xingzhi", first);
                    $('#mytbl').find('tr:last-child').after(temp);
                }
                if (n > 0 && n < first) {
                    temp = rowtmplate1;
                    temp = temp.replace("#leibie", value.leibie);
                    temp = temp.replace("#bu", value.bu);
                    temp = temp.replace("#sbu", value.sbu);
                    temp = temp.replace("#zongfuze", value.zongfuze + value.zongji);
                    temp = temp.replace("#zongganshi", value.zongganshi + value.ganji);
                    $('#mytbl').find('tr:last-child').after(temp);
                }
                if (n == first) {
                    temp = rowtmplate2;
                    temp = temp.replace("#xingzhi", value.xingzhi);
                    temp = temp.replace("#leibie", value.leibie);
                    temp = temp.replace("#bu", value.bu);
                    temp = temp.replace("#sbu", value.sbu);
                    temp = temp.replace("#zongfuze", value.zongfuze + value.zongji);
                    temp = temp.replace("#zongganshi", value.zongganshi + value.ganji);
                    temp = temp.replace("#@xingzhi", second);
                    $('#mytbl').find('tr:last-child').after(temp);
                }
                if (n > first && n < sum) {
                    temp = rowtmplate1;
                    temp = temp.replace("#leibie", value.leibie);
                    temp = temp.replace("#bu", value.bu);
                    temp = temp.replace("#sbu", value.sbu);
                    temp = temp.replace("#zongfuze", value.zongfuze + value.zongji);
                    temp = temp.replace("#zongganshi", value.zongganshi + value.ganji);
                    $('#mytbl').find('tr:last-child').after(temp);
                }
            });
            $('#mytbl').Identity({ colIndex: 1 }); //默认给第一列自动排序
            $.each(canshu1, function (n, value) {
                temp = rowtmplate3;
                temp = temp.replace("#leibie", value+parParam.changqu+"小計");
                $('#mytbl').find('tr:last-child').after(temp);
            });
            $.each(bu, function (n, value) {
                temp = rowtmplate4;
                temp = temp.replace("#bu", value + parParam.changqu + "小計");
                $('#mytbl').find('tr:last-child').after(temp);
            });
            temp = rowtmplate4;
            temp = temp.replace("#bu", parParam.changqu + "小計");
            $('#mytbl').find('tr:last-child').after(temp);
            ccc.sum = sum;
            ccc.canshu1 = canshu1;
            ccc.bu = bu;
            ccc.changqu = parParam.changqu;
            ccc.first = first;
            ccc.second = second;
        }
    }
    function part_applyEmp() {
        $('#load').window('open');
        var X = [{ ID: '利潤中心', TEXT: '利潤中心' }, { ID: '支援周邊', TEXT: '支援周邊' }, { ID: '3', TEXT: ''}];
        $("#xingzhi").combobox({
            editable: false,
            data: X,
            valueField: 'ID',
            textField: 'TEXT',
            panelHeight: 'auto'
        });
        var M = [{ ID: 'cable', TEXT: 'cable' }, { ID: 'connector', TEXT: 'connector' }, { ID: 'other', TEXT: 'other' }, { ID: '4', TEXT: ''}];
        $("#leibie").combobox({
            editable: false,
            data: M,
            valueField: 'ID',
            textField: 'TEXT',
            panelHeight: 'auto'
        });
        $("#xingming").val('');
        $("#ziwei").val('');
        $("#changqu").val('');
        $('#xingzhi').combobox('setValue', '3');
        $('#leibie').combobox('setValue', '4');
        $("#bu").val('');
        $("#sbu").val('');
        $("#ruchang").val('');
        $("#lichang").val('');
        $("#yuanying").val('');
    }
    var HH = true;
    var HK = true;
    function part_applySbu() {

        var Q = { mode: "changqu" };
        if (HK) {
            $.post("getData.ashx",
            Q,
            function (data, status) {
                if (data != "NG") {
                    var P = eval("(" + data + ")");
                    $.each(P, function (n, value) {
                        P[n].ID = n;
                    });
                    $("#bu0").combobox({
                        data: P,
                        valueField: 'ID',
                        textField: 'TEXT',
                        panelHeight: 'auto',
                        onSelect: function (rec) {
                            var url = { bu: rec.TEXT, mode: "changqu1", changqu: parParam.changqu };
                            $.post("getData.ashx",
                            url,
                            function (data, status) {
                                if (data != "NG") {
                                    var G = eval("(" + data + ")");
                                    $.each(G, function (n, value) {
                                        G[n].ID = n;
                                    });
                                    if (HH) {
                                        $('#sbu0').combobox({
                                            data: G,
                                            valueField: 'ID',
                                            textField: 'TEXT',
                                            panelHeight: 'auto'
                                        });
                                        HH = false;
                                    }
                                    else {
                                        $('#sbu0').combobox('loadData', G);
                                    }  
                                }
                            });
                        }
                    });
                }
            });
            HK = false;
        }
        var X = [{ ID: '利潤中心', TEXT: '利潤中心' }, { ID: '支援周邊', TEXT: '支援周邊' }, { ID: '3', TEXT: ''}];
       
        $("#xingzhi0").combobox({
            editable: false,
            data: X,
            valueField: 'ID',
            textField: 'TEXT',
            panelHeight: 'auto'
        });
        var M = [{ ID: 'cable', TEXT: 'cable' }, { ID: 'connector', TEXT: 'connector' }, { ID: 'other', TEXT: 'other' }, { ID: '4', TEXT: ''}];
        $("#leibie0").combobox({
            editable: false,
            data: M,
            valueField: 'ID',
            textField: 'TEXT',
            panelHeight: 'auto'
        });
        
        $('#xingzhi0').combobox('setValue', '3');
        $('#leibie0').combobox('setValue', '4');
        $("#changqu0").val(parParam.changqu);
        
        $("#sbu0").val('先選擇BU');
        $("#zongganshi0").val('');
        $("#zongfuze0").val('');
        $("#zongji").val('');
        $("#ganji").val('');

        $('#load1').window('open');
    }
    function part_empno() {
        var empno = $("#gonghao").val();
        if (empno == "") {
            alert("工號不能為空！");
        }
        else {
            var parPa = { empno: empno, mode: "emplayee", changqu: parParam.changqu };
            $.post("getData.ashx",
            parPa,
            function (data, status) {
                if (data == "NG") {
                    alert("搜索不到此人，請手動添加！");
                }
                else {
                    var X = eval("(" + data + ")");
                    $("#xingming").val(X[0].xingming);
                    $("#ziwei").val(X[0].ziwei);
                    $("#changqu").val(X[0].changqu);
                    $('#xingzhi').combobox('setValue', X[0].xingzhi);
                    $('#leibie').combobox('setValue', X[0].leibie);
                    $("#bu").val(X[0].bu);
                    $("#sbu").val(X[0].sbu);
                    $("#ruchang").val(X[0].ruchang.substr(0, 10));
                    $("#yuanying").val(X[0].yuanying);
                }
            });
        }
    }
    function part_sbu() {
        if ($("#sbu0").attr('class')=="") {
            alert("SBU不能為空！");
        }
        else {
            sbu = $("#sbu0").combobox('getText');
            var parPa2 = { sbu: sbu, mode: "sbu", changqu: parParam.changqu };
            $.post("getData.ashx",
            parPa2,
            function (data, status) {
                if (data == "NG") {
                    alert("SBU未创建，請手動添加，提交！");
                }
                else {
                    var X = eval("(" + data + ")");
                    $("#changqu0").val(X[0].changqu);
                    $('#xingzhi0').combobox('setValue', X[0].xingzhi);
                    $('#leibie0').combobox('setValue', X[0].leibie);
                    $("#zongfuze0").val(X[0].zongfuze);
                    $("#zongganshi0").val(X[0].zongganshi);
                    $("#zongji0").val(X[0].zongji);
                    $("#ganji0").val(X[0].ganji);
                }
            });
        }
    }
    function part_btnEp1() {
        var parPa2 = new Object();
        if ($("#sbu0").attr('class')=="") {
            alert("SBU不能為空！");
        }
        else {
            parPa2.changqu0 = $("#changqu0").val();
            parPa2.xingzhi0 = $('#xingzhi0').combobox('getText');
            parPa2.leibie0 = $('#leibie0').combobox('getText');
            parPa2.bu0 = $("#bu0").combobox('getText');
            parPa2.sbu0 = $("#sbu0").combobox('getText');
            parPa2.zongfuze0 = $("#zongfuze0").val();
            parPa2.zongganshi0 = $("#zongganshi0").val();
            parPa2.zongji0 = $("#zongji0").val();
            parPa2.ganji0 = $("#ganji0").val();
            if (parPa2.leibie0 == "") {
                alert("類別不能為空！");
            }
            else {
                if (parPa2.xingzhi0 == "") {
                    alert("性質不能為空！");
                }
                else {
                    parPa2.mode = "queren";
                    $.post("getData.ashx",
                    parPa2,
                    function (data, status) {
                        if (data == "NG") {
                            alert("提交失敗！");
                        }
                        else {
                            alert("提交成功！");
                        }
                    });
                }
            }
        }
        
    }
    function part_btnEp() {
        var parPa1 = new Object();
         parPa1.gonghao = $("#gonghao").val();
        parPa1.xingming = $("#xingming").val();
        parPa1.ziwei = $("#ziwei").val();
        parPa1.changqu = $("#changqu").val();
        parPa1.xingzhi = $('#xingzhi').combobox('getText');
        parPa1.leibie = $('#leibie').combobox('getText');
        parPa1.bu = $("#bu").val();
        parPa1.sbu = $("#sbu").val();
        parPa1.ruchang = $("#ruchang").val();
        parPa1.lichang = $("input[name='lichang']").val();
        parPa1.yuanying = $("#yuanying").val();
        if(parPa1.gonghao==""){
            alert("工號不能為空！");
        }
        else{
            if(parPa1.xingzhi==""){
                alert("性質不能為空！");
            }
            else{
                if(parPa1.leibie==""){
                    alert("類別不能為空！");
                }
                else{
                    if(parPa1.yuanying==""){
                    alert("離職原因不能為空！");
                    }
                    else {
                        if (parPa1.lichang == "") {
                            alert("離職日期不能為空！");
                        }
                        else{
                            parPa1.mode = "tijiao";
                            $.post("getData.ashx",
                            parPa1,
                            function (data, status) {
                                if (data == "NG") {
                                    alert("提交失敗！");
                                }
                                else {
                                    alert("提交成功！");
                                    $("#gonghao").val('');
                                    $("#xingming").val('');
                                    $("#ziwei").val('');
                                    $("#changqu").val('');
                                    $('#xingzhi').combobox('setValue', '3');
                                    $('#leibie').combobox('setValue', '4');
                                    $("#bu").val('');
                                    $("#sbu").val('');
                                    $("#ruchang").val('');
                                    $("#lichang").val('');
                                    $("#yuanying").val('');
                                }
                            });
                        }
                    }
                }
            }
        }
    }
    function part_leave() {
        $("#mingxi tr:not(:first)").remove(); 
        $('#load8').window('close');
    }
</script> 
    <style type="text/css">
        .style4
        {
            width: 53px;
            height: 28px;
        }
        .style5
        {
            width: 57px;
            height: 28px;
        }
        .style6
        {
            width: 64px;
            height: 28px;
        }
        .style7
        {
            width: 62px;
            height: 28px;
        }
        .style8
        {
            height: 28px;
        }
        .style9
        {
            width: 16px;
            height: 19px;
        }
        #zongfuze0
        {
            width: 134px;
        }
        #zongganshi0
        {
            width: 134px;
        }
        </style>
</head> 
<body border=0 cellpadding=0 cellspacing=0 width=2668 class='xl316682'
 style='border-collapse:collapse;table-layout:fixed;width:2013pt'> 
    <br />
    <div>
        <input id="diqu" value="選擇廠區" style="display:none"/>截止時間：<input id="dd" name="dd" type="text" class="easyui-datebox" editable=false />
    <a href="javascript:part_search()" class="easyui-linkbutton" >查询</a>&nbsp;&nbsp;
    <a href="javascript:part_applyEmp()" class="easyui-linkbutton" >新增修改離職人員明細</a>
    <a href="javascript:part_applySbu()" class="easyui-linkbutton" style="display:none">新增修改SBU信息</a>
    </div>
<div> 
<br />
<table cellpadding="0" cellspacing="1" id="mytbl"> 
 <tr height=32 style='height:24.0pt'>
  <td colspan=52 height=32 class='xl1616682' width=2668 style='height:24.0pt;
  width:2013pt'></td>
 </tr>
 <tr class='xl326682' height=22 style='height:16.5pt'>
  <td rowspan=2 height=70 class='xl1466682' width=31 style='border-bottom:.5pt solid black;
  height:52.5pt;border-top:none;width:23pt'>序號</td>
  <td rowspan=2 class='xl1466682' width=38 style='border-bottom:.5pt solid black;
  border-top:none;width:29pt'>廠區</td>
  <td rowspan=2 class='xl1466682' width=42 style='border-bottom:.5pt solid black;
  border-top:none;width:32pt'>　</td>
  <td rowspan=2 class='xl1466682' width=56 style='border-bottom:.5pt solid black;
  border-top:none;width:42pt'>類別</td>
  <td rowspan=2 class='xl1466682' width=50 style='border-bottom:.5pt solid black;
  border-top:none;width:38pt'>BU</td>
  <td rowspan=2 class='xl1466682' width=71 style='border-bottom:.5pt solid black;
  border-top:none;width:53pt'>SBU</td>
  <td rowspan=2 class='xl1466682' width=133 style='border-bottom:.5pt solid black;
  border-top:none;width:100pt'>總負責</td>
  <td rowspan=2 class='xl1466682' width=136 style='border-bottom:.5pt solid black;
  border-top:none;width:102pt'>總幹事</td>
  <td colspan=8 class='xl1516682' style='border-right:.5pt solid black;
  border-left:none'>2014-11-1</td>
  <td colspan=8 class='xl1516682' style='border-right:.5pt solid black;
  border-left:none'>2014-11-5</td>
  <td colspan=8 class='xl1516682' style='border-right:.5pt solid black;
  border-left:none'>2014-11-6</td>
  <td colspan=4 class='xl1486682' style='border-right:.5pt solid black;
  border-left:none'>累計</td>
 </tr>
 <tr class='xl326682' height=48 style='height:36.0pt'>
  <td height=48 class='xl336682' width=37 style='height:36.0pt;border-top:none;
  border-left:none;width:28pt' bgcolor="White">員一</td>
  <td class=xl346682 width=37 style='border-top:none;border-left:none;
  width:28pt'>員二-員三</td>
  <td class=xl356682 width=37 style='border-top:none;border-left:none;
  width:28pt'>員級合計</td>
  <td class='xl336682' width=37 style='border-top:none;border-left:none;
  width:28pt'>師級</td>
  <td class='xl366682' width=37 style='border-top:none;border-left:none;
  width:28pt'>離職人數</td>
  <td class='xl376682' width=51 style='border-top:none;border-left:none;
  width:38pt'>實際離職比例</td>
  <td class='xl386682' width=51 style='border-top:none;border-left:none;
  width:38pt'>標準離職比例</td>
  <td class='xl396682' width=43 style='border-top:none;border-left:none;
  width:32pt'>BU<font class="font66682">總<br>
    人數</font></td>
  <td class='xl336682' width=44 style='border-top:none;border-left:none;
  width:33pt'>員一</td>
  <td class=xl346682 width=46 style='border-top:none;border-left:none;
  width:35pt'>員二-員三</td>
  <td class=xl356682 width=46 style='border-top:none;border-left:none;
  width:35pt'>員級合計</td>
  <td class='xl336682' width=41 style='border-top:none;border-left:none;
  width:31pt'>師級</td>
  <td class='xl366682' width=42 style='border-top:none;border-left:none;
  width:32pt'>離職人數</td>
  <td class='xl376682' width=66 style='border-top:none;border-left:none;
  width:50pt'>實際離職比例</td>
  <td class='xl386682' width=59 style='border-top:none;border-left:none;
  width:44pt'>標準離職比例</td>
  <td class='xl396682' width=54 style='border-top:none;border-left:none;
  width:41pt'>BU<font class="font66682">總<br>
    人數</font></td>
  <td class='xl336682' width=44 style='border-top:none;border-left:none;
  width:33pt'>員一</td>
  <td class='xl346682' width=46 style='border-top:none;border-left:none;
  width:35pt'>員二-員三</td>
  <td class='xl356682' width=46 style='border-top:none;border-left:none;
  width:35pt'>員級合計</td>
  <td class='xl336682' width=41 style='border-top:none;border-left:none;
  width:31pt'>師級</td>
  <td class='xl366682' width=42 style='border-top:none;border-left:none;
  width:32pt'>離職人數</td>
  <td class='xl376682' width=66 style='border-top:none;border-left:none;
  width:50pt'>實際離職比例</td>
  <td class='xl386682' width=59 style='border-top:none;border-left:none;
  width:44pt'>標準離職比例</td>
  <td class='xl396682' width=54 style='border-top:none;border-left:none;
  width:41pt'>BU<font class="font66682">總<br>
    人數</font></td>
  <td class='xl366682' width=44 style='border-top:none;border-left:none;
  width:33pt'>離職<br>
    人數</td>
  <td class='xl376682' width=47 style='border-top:none;border-left:none;
  width:35pt'>實際離職比例</td>
  <td class='xl386682' width=48 style='border-top:none;border-left:none;
  width:36pt'>標準離職比例</td>
  <td class='xl406682' width=50 style='border-top:none;border-left:none;
      width:38pt'>BU平均人數</td>
 </tr>
</table> 
</div> 
<div>
管控標準： 正常   離職率≦4%，用綠色<img alt="" class="style9" src="../images/green.jpg" />管控； <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 預警    4%<離職率≦ 5%，用黃色<img 
        alt="" class="style9" src="../images/yellow.jpg" />管控； <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 超標   離職率>5%，用紅色<img 
        alt="" class="style9" src="../images/red.jpg" />管控； 
</div>
<div id="load" class="easyui-window" title="新增修改離職人員明細" collapsible="false" minimizable="false"
        maximizable="false" closable="false" icon="icon-tip"  style="width: 430px; height: 450px; padding: 5px;
        background: #fafafa;">
        <br />
        <div>
        工號：&nbsp;&nbsp;
        <input id="gonghao" type="text" value="" />&nbsp;&nbsp;
        <a href="javascript:part_empno()" class="easyui-linkbutton" >檢索</a>
        </div>
        <br />
        <div>
            明細&nbsp;&nbsp;
        </div>
        <br />
        <div>
            &nbsp;姓名：<input id="xingming" type="text" value=""/> 
            資位：<input id="ziwei" type="text" value=""/> 
             </div>
        <br />
        <br />
        <div>
            &nbsp;性質：<input id="xingzhi" name="xingzhi" value="" /> 
            類別：<input id="leibie" name="leibie" value="" />
            </div>
        <br />
        <br />
        <div>
             &nbsp;廠區：<input id="changqu" type="text" value="" /> 
             BU：<input id="bu" type="text" value="" /> 
             SBU：<input id="sbu" type="text" value="" />
             </div>
        <br />
        <br />
        <div>
             &nbsp;入職時間：<input id="ruchang" type="text" value="" />
             </div>
        <br />
        <div>
            &nbsp;
            離職時間：<input id="lichang" class="easyui-datebox" editable="false" name="lichang" type="text" />
             </div>
        <br />
        <br />
         離職原因：<input id="yuanying" type="text" />
         <br />
         <br />
        <div region="south" border="false" style="text-align: right; height: 30px; line-height: 30px;">
        <a id="btnEp" class="easyui-linkbutton" icon="icon-ok" href="javascript:part_btnEp()" >
            提交</a> &nbsp;&nbsp;<a id="btnCancel" class="easyui-linkbutton" icon="icon-cancel" href="javascript:void(0)">退出</a>
        </div>
</div>
<div id="load1" class="easyui-window" title="新增修改SBU信息" collapsible="false" minimizable="false"
        maximizable="false" closable="false" icon="icon-tip"  style="width: 430px; height: 450px; padding: 5px;
        background: #fafafa;">
        <br />
        <div>
            B&nbsp; U： &nbsp;&nbsp;<input id="bu0" type="text" value="" /> 
        </div>
        <div>
            SBU：&nbsp;&nbsp;
        <input id="sbu0" type="text" />&nbsp;&nbsp;
        <a href="javascript:part_sbu()" class="easyui-linkbutton" >檢索</a>
        </div>
        <br />
        <br />
        <div>
        &nbsp;性質：<input id="xingzhi0" name="xingzhi0" value="" /> 
        類別：<input id="leibie0" name="leibie0" value="" />
        </div>
        <br />
        <br />
        <div>
        &nbsp;廠區：<input id="changqu0" type="text" value="" /> 
        </div>
        <br />
        <br />
        <div>
        &nbsp;總負責人：<input id="zongfuze0" type="text" value="" /> 
        電話：<input id="zongji0" type="text" value="" /> 
        </div>
        <br />
        <br />
        <div>
        &nbsp;總&nbsp; 幹&nbsp; 事：<input id="zongganshi0" type="text" value="" /> 
        電話：<input id="ganji0" type="text" value="" /> 
        </div>
        <br />
        <br />
        <div region="south" border="false" style="text-align: right; height: 30px; line-height: 30px;">
        <a id="btnEp1" class="easyui-linkbutton" icon="icon-ok" href="javascript:part_btnEp1()" >
            提交</a> &nbsp;&nbsp;<a id="btnCancel1" class="easyui-linkbutton" icon="icon-cancel" href="javascript:void(0)">退出</a>
        </div>
</div>

<div id="load8" class="easyui-window" title="離職人員明細" collapsible="false" minimizable="false"
        maximizable="false" closable="false" icon="icon-tip"  style="width: 600px; height: 400px; padding: 5px;
        background: #fafafa;">
        <br />
        <div region="south" border="false" style="text-align: right; height: 30px; line-height: 30px;">
        <a class="easyui-linkbutton" icon="icon-cancel" href="javascript:part_leave()">退出</a>
        </div>
        <br />
        <table id="mingxi" width=100% border="1" cellspacing="0" cellpadding="0">
            <tr>
                <td align="center" class="style6">
                    工號</td>
                <td align="center" class="style7">
                    姓名</td>
                <td align="center" class="style4">
                    資位</td>
                    <td align="center" class="style5">
                        部門</td>
                <td align="center" class="style8">
                    離職原因</td>
            </tr>
        </table>
        <br />

        <br />
</div>
<div id="load99" class="easyui-window" title="加载提示" collapsible="false" minimizable="false"
        maximizable="false" closable="false" icon="icon-tip"  style="width: 300px; height: 150px; padding: 5px;
        background: #fafafa;">
        <br />
        <h1 style="color: #FF0000; width: 251px;">加载中，请稍等！</h1>
        <br />
</div>
</body> 
</html> 

