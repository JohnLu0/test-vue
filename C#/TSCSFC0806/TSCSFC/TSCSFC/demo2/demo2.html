<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>流程追溯明細</title>
    <link href="../jsui/themes/default/easyui.css" rel="stylesheet" type="text/css" />
    <link href="../jsui/themes/icon.css" rel="stylesheet" type="text/css" />
    <!--<script src="../jsui/jquery-1.4.1.min.js" type="text/javascript"></script>-->
    <script src="../jsui/jquery-1.6.min.js" type="text/javascript"></script>
    <script src="../jsui/jquery.easyui.min.js" type="text/javascript"></script>
    <script src="../jsui/locale/easyui-lang-zh_CN.js" type="text/javascript"></script>
    <script type="text/javascript">

        var first = $("input[name='first']").val();
        var second = $("input[name='second']").val();

        var keyWord = $("#keyWord").val();

        var partParam = { mode: "load", keyWord: keyWord, first: "XXX", second: "" };


        $(function () {
            $('#part').datagrid({
                loadMsg: '数据加载中请稍后……',
                title: '測試包裝明細',
                iconCls: 'icon-sum',
                loadMsg: "loading",
                striped: true,
                fit: false, //大小自适应
                fitColumns: true,
                pagination: true, //分页控件
                collapsible: true, //是否可折叠
                singleSelect: true, //是否单选
                queryParams: partParam,  //參數
                rownumbers: true, //行数
                idField: 'itemid',
                showFooter: true,
                url: "demo2.ashx",
                columns: [[
                    { field: 's_Line', title: 's_Line', width: 120, align: 'center', editor: 'text' },
					{ field: 's_STN', title: 's_STN', width: 150, align: 'center', editor: 'text' },
                    { field: 's_STName', title: 's_STName', width: 150, align: 'center', editor: 'text' },
                    { field: 's_ComputerName', title: 's_ComputerName', width: 150, align: 'center', editor: 'text' },
                    { field: 's_BarCode', title: 's_BarCode', width: 150, align: 'center', editor: 'text' },
                    { field: 's_Result', title: 's_Result', width: 150, align: 'center', editor: 'text' },
                    { field: 'i_Times', title: 'i_Times', width: 150, align: 'center', editor: 'text' },
                    { field: 'd_Datetime', title: 'd_Datetime', width: 150, align: 'center', editor: 'text' }
                ]],
                onLoadSuccess: function (data) {
                    // alert(partParam);
                    $('#part').datagrid('options').queryParams = partParam;
                }
            });
            var p = $('#part').datagrid('getPager');
            $(p).pagination({
                pageSize: 10,
                pageList: [10, 50, 100, 200],
                beforePageText: '第',
                afterPageText: '页    共{pages} 页',
                displayMsg: '当前显示 {from} - {to} 条记录   共 {total} 条记录'
            });
            $('#part').datagrid('reload');
        });

        function part_search() {
            partParam.keyWord = $("#keyWord").val();
            //if (partParam.FormNo == "") {
            //    partParam.FormNo = "%";
            //}



            if ($("input[name='first']")) {
                partParam.first = $("input[name='first']").val();
                partParam.second = $("input[name='second']").val();
            }
            if (partParam.first == "") {
                alert("開始時間不能為空!");
            }
            else {
                if (partParam.second == "") {
                    alert("結束時間不能為空!");
                }
                else {
                    if (partParam.first > partParam.second) {
                        alert("開始時間不能大於結束時間!");
                    }
                    else {
                        $($('#part').datagrid('getPager')).pagination({ pageNumber: 1 });
                        $('#part').datagrid('options').queryParams = partParam;
                        $("#part").datagrid('reload');
                    }
                }
            }
        }

        function Save_Excel() {
            var filename = "package";
            var first = $("input[name='first']").val();
            var second = $("input[name='second']").val();
            var keyWord = $("#keyWord").val();

            if (first == "") {
                alert("開始時間不能為空!");
            } else {
                if (second == "") {
                    alert("結束時間不能為空!");
                }
                else {
                    if (first > second) {
                        alert("開始時間不能大於結束時間!");
                    } else {
                        $.post('demo2.ashx?first=' + first + '&second=' + second + '&keyWord=' + keyWord + '&mode=download',
                        function (result) {
                            location.href = location.origin + "/" + result;
                        }
                        )
                    }
                }
            }
        }

    </script>
</head>



<body style="height:400px">
    <br />
    <div>
        日期：<font color="red">*</font><input name="first" type="text" class="easyui-datebox" editable=false
                                            style="width:89px" />
        &nbsp;至&nbsp;<font color="red">*</font><input name="second" type="text" class="easyui-datebox" editable=false
                                                      style="width:89px" />  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        關鍵字： <input id="keyWord" type="text" /> &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <a href="javascript:part_search()" class="easyui-linkbutton">查询</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <a href="javascript:;" data-options="iconCls:'icon-save'" class="easyui-linkbutton" onclick="Save_Excel()">導出Excel</a>
    </div>
    <br />
    <table id="part"></table>
</body>
</html>
